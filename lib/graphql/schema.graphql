# =============================================================================
# Bounties GraphQL Schema
# =============================================================================
# This schema mirrors the existing REST API structure for bounties and projects,
# implements the Connection pattern for pagination, and establishes subscriptions
# to replace WebSocket events for real-time updates.
# =============================================================================

# -----------------------------------------------------------------------------
# Enumerations
# -----------------------------------------------------------------------------

"""
Type of bounty task, matching the BountyType from types/bounty.ts
"""
enum BountyType {
  FEATURE
  BUG
  DOCUMENTATION
  REFACTOR
  OTHER
}

"""
Current status of a bounty
"""
enum BountyStatus {
  OPEN
  CLAIMED
  CLOSED
}

"""
Difficulty level for bounties
"""
enum DifficultyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

"""
Status of a project, matching types/project.ts
"""
enum ProjectStatus {
  ACTIVE
  ENDED
  DRAFT
}

"""
Sort order for queries
"""
enum SortOrder {
  ASC
  DESC
}

# -----------------------------------------------------------------------------
# Core Object Types
# -----------------------------------------------------------------------------

"""
A bounty represents a task or issue with an associated reward.
Fields align with the TypeScript interface in types/bounty.ts.
"""
type Bounty {
  id: ID!
  type: BountyType!

  projectId: String!
  projectName: String!
  projectLogoUrl: String

  issueTitle: String!
  issueNumber: Int!
  githubRepo: String!
  githubIssueUrl: String!

  description: String!
  rewardAmount: Float
  rewardCurrency: String!

  difficulty: DifficultyLevel
  tags: [String!]!

  status: BountyStatus!

  createdAt: String!
  updatedAt: String!

  # Optional fields for detailed view
  requirements: [String!]
  scope: String
}

"""
A project that can have multiple bounties.
Fields align with the TypeScript type in types/project.ts.
"""
type Project {
  id: ID!
  name: String!
  logoUrl: String
  description: String!
  tags: [String!]!
  bountyCount: Int!
  openBountyCount: Int!
  creatorName: String!
  creatorAvatarUrl: String
  prizeAmount: String!
  status: ProjectStatus!
  bannerUrl: String
  createdAt: String!
  updatedAt: String!
}

"""
User type based on better-auth's implicit structure.
Kept minimal since User operations are handled by better-auth.
"""
type User {
  id: ID!
  email: String!
  name: String
  image: String
  emailVerified: Boolean
  createdAt: String!
  updatedAt: String!
}

# -----------------------------------------------------------------------------
# Pagination Types (Connection Pattern)
# -----------------------------------------------------------------------------

"""
Pagination metadata for connection-based responses.
"""
type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

"""
Input for offset-style pagination queries.
Supports hybrid approach: offset-style parameters with Connection response structure.
"""
input PaginationInput {
  page: Int
  limit: Int
}

"""
An edge in the bounty connection, containing the node and its cursor.
"""
type BountyEdge {
  node: Bounty!
  cursor: String!
}

"""
A connection to a list of bounties with pagination support.
"""
type BountyConnection {
  edges: [BountyEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

"""
An edge in the project connection, containing the node and its cursor.
"""
type ProjectEdge {
  node: Project!
  cursor: String!
}

"""
A connection to a list of projects with pagination support.
"""
type ProjectConnection {
  edges: [ProjectEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

# -----------------------------------------------------------------------------
# Input Types for Mutations
# -----------------------------------------------------------------------------

"""
Input for creating a new bounty.
Excludes system-generated fields: id, createdAt, updatedAt, status.
"""
input CreateBountyInput {
  type: BountyType!

  projectId: String!
  projectName: String!
  projectLogoUrl: String

  issueTitle: String!
  issueNumber: Int!
  githubRepo: String!
  githubIssueUrl: String!

  description: String!
  rewardAmount: Float
  rewardCurrency: String!

  difficulty: DifficultyLevel
  tags: [String!]!

  requirements: [String!]
  scope: String
}

"""
Input for updating an existing bounty.
All fields are optional to support partial updates.
"""
input UpdateBountyInput {
  type: BountyType

  projectId: String
  projectName: String
  projectLogoUrl: String

  issueTitle: String
  issueNumber: Int
  githubRepo: String
  githubIssueUrl: String

  description: String
  rewardAmount: Float
  rewardCurrency: String

  difficulty: DifficultyLevel
  tags: [String!]

  status: BountyStatus

  requirements: [String!]
  scope: String
}

"""
Input for creating a new project.
"""
input CreateProjectInput {
  name: String!
  logoUrl: String
  description: String!
  tags: [String!]!
  creatorName: String!
  creatorAvatarUrl: String
  prizeAmount: String!
  status: ProjectStatus!
  bannerUrl: String
}

"""
Input for updating an existing project.
All fields are optional to support partial updates.
"""
input UpdateProjectInput {
  name: String
  logoUrl: String
  description: String
  tags: [String!]
  creatorName: String
  creatorAvatarUrl: String
  prizeAmount: String
  status: ProjectStatus
  bannerUrl: String
}

# -----------------------------------------------------------------------------
# Filter and Sort Input Types
# -----------------------------------------------------------------------------

"""
Input for filtering bounty queries.
"""
input BountyFilterInput {
  status: BountyStatus
  type: BountyType
  difficulty: DifficultyLevel
  projectId: String
  search: String
}

"""
Input for sorting bounty queries.
"""
input BountySortInput {
  sortBy: String
  sortOrder: SortOrder
}

"""
Input for filtering project queries.
"""
input ProjectFilterInput {
  status: ProjectStatus
  tags: [String!]
  hasOpenBounties: Boolean
  search: String
}

"""
Input for sorting project queries.
"""
input ProjectSortInput {
  sortBy: String
  sortOrder: SortOrder
}

# -----------------------------------------------------------------------------
# Query Operations
# -----------------------------------------------------------------------------

type Query {
  # Bounty Queries
  """
  Retrieve a paginated list of bounties with optional filtering and sorting.
  """
  bounties(
    filter: BountyFilterInput
    sort: BountySortInput
    pagination: PaginationInput
  ): BountyConnection!

  """
  Retrieve a single bounty by its ID.
  Returns null if the bounty is not found.
  """
  bounty(id: ID!): Bounty

  # Project Queries
  """
  Retrieve a paginated list of projects with optional filtering and sorting.
  """
  projects(
    filter: ProjectFilterInput
    sort: ProjectSortInput
    pagination: PaginationInput
  ): ProjectConnection!

  """
  Retrieve a single project by its ID.
  Returns null if the project is not found.
  """
  project(id: ID!): Project

  """
  Retrieve all unique project tags for filtering UI.
  """
  projectTags: [String!]!
}

# -----------------------------------------------------------------------------
# Mutation Operations
# -----------------------------------------------------------------------------

type Mutation {
  # Bounty Mutations
  """
  Create a new bounty.
  """
  createBounty(input: CreateBountyInput!): Bounty!

  """
  Update an existing bounty by ID.
  """
  updateBounty(id: ID!, input: UpdateBountyInput!): Bounty!

  """
  Delete a bounty by ID.
  Returns true if successfully deleted.
  """
  deleteBounty(id: ID!): Boolean!

  """
  Claim a bounty by ID.
  Updates the bounty status to CLAIMED.
  """
  claimBounty(id: ID!): Bounty!

  # Project Mutations
  """
  Create a new project.
  """
  createProject(input: CreateProjectInput!): Project!

  """
  Update an existing project by ID.
  """
  updateProject(id: ID!, input: UpdateProjectInput!): Project!

  """
  Delete a project by ID.
  Returns true if successfully deleted.
  """
  deleteProject(id: ID!): Boolean!
}

# -----------------------------------------------------------------------------
# Subscription Operations
# -----------------------------------------------------------------------------
# These subscriptions replace WebSocket events from lib/socket/client.ts
# for real-time updates using GraphQL subscriptions.

type Subscription {
  """
  Emitted when a new bounty is created.
  Replaces the 'bounty.created' WebSocket event.
  Optionally filter by projectId for scoped updates.
  """
  bountyCreated(projectId: String): Bounty!

  """
  Emitted when a bounty is updated.
  Replaces the 'bounty.updated' WebSocket event.
  Optionally filter by projectId for scoped updates.
  """
  bountyUpdated(projectId: String): Bounty!

  """
  Emitted when a bounty is deleted.
  Replaces the 'bounty.deleted' WebSocket event.
  Returns the ID of the deleted bounty.
  Optionally filter by projectId for scoped updates.
  """
  bountyDeleted(projectId: String): ID!
}
